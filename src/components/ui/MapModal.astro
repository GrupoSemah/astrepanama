---
interface Props {
  imageUrl: string;
  imageAlt?: string;
}

const { imageUrl, imageAlt = "Mapa ampliado" } = Astro.props;
---

<div id="map-modal" class="fixed inset-0 z-50 hidden items-center justify-center">
  <div class="absolute inset-0 bg-primary opacity-80"></div>
  <div class="relative z-10 w-full max-w-6xl max-h-[90vh] overflow-hidden">
    <button 
      id="close-modal" 
      class="absolute top-4 right-4 z-20 bg-white/90 rounded-full p-2 flex items-center justify-center hover:bg-white transition-colors"
      aria-label="Cerrar modal"
    >
      <svg 
        width="24" 
        height="24" 
        viewBox="0 0 24 24" 
        fill="none" 
        xmlns="http://www.w3.org/2000/svg"
      >
        <path 
          d="M18 6L6 18M6 6L18 18" 
          stroke="#222222" 
          stroke-width="2" 
          stroke-linecap="round" 
          stroke-linejoin="round"
        />
      </svg>
    </button>
    
    <div class="relative w-full h-full p-4 md:p-8 overflow-auto">
      <img 
        src={imageUrl} 
        alt={imageAlt} 
        class="w-full h-auto object-contain"
        id="modal-map-image" 
      />
    </div>
  </div>
</div>

<script>
  // Definimos la interfaz para el evento personalizado
  interface MapModalEvent extends CustomEvent {
    detail: {
      imageUrl: string;
    };
  }

  // Función simple para gestionar el modal del mapa
  document.addEventListener('DOMContentLoaded', () => {
    const mapModal = document.getElementById('map-modal');
    const closeModalBtn = document.getElementById('close-modal');
    const modalImage = document.getElementById('modal-map-image') as HTMLImageElement;

    // Abrir modal
    document.addEventListener('openMapModal', ((e: MapModalEvent) => {
      if (mapModal && modalImage) {
        const imageUrl = e.detail?.imageUrl;
        
        if (imageUrl) {
          modalImage.src = imageUrl;
        }
        
        // Mostrar modal
        mapModal.classList.remove('hidden');
        mapModal.classList.add('flex');
        document.body.style.overflow = 'hidden';
      }
    }) as EventListener);

    // Cerrar con botón X
    if (closeModalBtn) {
      closeModalBtn.addEventListener('click', () => {
        if (mapModal) {
          mapModal.classList.add('hidden');
          mapModal.classList.remove('flex');
          document.body.style.overflow = '';
        }
      });
    }

    // Cerrar con tecla Escape
    document.addEventListener('keydown', (e: KeyboardEvent) => {
      if (e.key === 'Escape' && mapModal && !mapModal.classList.contains('hidden')) {
        mapModal.classList.add('hidden');
        mapModal.classList.remove('flex');
        document.body.style.overflow = '';
      }
    });
  });
</script>
