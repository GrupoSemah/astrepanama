---
import { getImageUrl } from "@/services/cloudStorage";
import MapModal from "@/components/ui/MapModal.astro";

interface Props {
  title?: string;
}

const { title = "Ubicación" } = Astro.props;

const mapImageFolder = "UBICACION";
const mapImageName = "Mapa%20Astre.webp";
const mapImageUrl = getImageUrl(mapImageName, mapImageFolder);

const latitude = 8.988646429787098;
const longitude = -79.5032962191003;
---

<section
  id="ubicacion"
  class="min-h-screen w-full relative flex flex-col max-w-full overflow-hidden"
>
  <div class="w-full h-[85vh] md:h-[90vh] flex-grow relative">
    <div class="absolute inset-0">
      <button 
        id="open-map-modal"
        class="w-full h-full border-0 p-0 m-0 bg-transparent cursor-pointer"
        aria-label="Ver mapa ampliado"
      >
        <img 
          src={mapImageUrl} 
          alt="Mapa de ubicación de Astre" 
          class="w-full h-full object-cover" 
          id="map-image"
        />
      </button>
    </div>
    <div class="absolute inset-0 flex items-end justify-center pb-12 md:pb-16">
      <div class="w-full max-w-md px-4 md:px-0">
        <a
          href="https://maps.app.goo.gl/j7CG3XsMig97BgDF6"
          target="_blank"
          rel="noopener noreferrer"
          class="group flex items-center justify-between w-full border border-black rounded px-6 py-3 bg-white/90 backdrop-blur-sm text-black hover:bg-primary hover:text-white transition-colors"
        >
          <span class="text-lg font-medium">Ubicación del proyecto</span>
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            class="transition-transform duration-300 group-hover:rotate-90"
          >
            <path
              d="M7 17L17 7M17 7H7M17 7V17"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
          </svg>
        </a>
      </div>
    </div>
  </div>
</section>

<MapModal imageUrl={mapImageUrl} imageAlt="Mapa detallado de ubicación de Astre" />

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const openModalBtn = document.getElementById('open-map-modal');
    const mapImage = document.getElementById('map-image');

    if (openModalBtn && mapImage) {
      openModalBtn.addEventListener('click', () => {
        // Usando la función global definida en MapModal.astro
        if (typeof openMapModal === 'function') {
          openMapModal(mapImage.getAttribute('src'));
        } else {
          // Fallback usando el evento personalizado (por compatibilidad)
          const openMapModalEvent = new CustomEvent('openMapModal', {
            detail: { imageUrl: mapImage.getAttribute('src') }
          });
          document.dispatchEvent(openMapModalEvent);
        }
      });
    }
  });
</script>
