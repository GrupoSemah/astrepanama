---
import { getImageUrl } from "@/services/cloudStorage";
import MapModal from "@/components/ui/MapModal.astro";

interface Props {
  title?: string;
}

const { title = "Una ubicación que lo tiene todo" } = Astro.props;

const mapImageFolder = "UBICACION";
const mapImageName = "Mapa%20Astre.webp";
const mapImageUrl = getImageUrl(mapImageName, mapImageFolder);

const latitude = 8.988646429787098;
const longitude = -79.5032962191003;

const locations = [
  { name: "Multiplaza Mall", id: "multiplaza" },
  { name: "Centro de Convenciones Atlapa", id: "atlapa" },
  { name: "Corredor Sur", id: "corredor" },
  { name: "Sheraton Grand Panamá", id: "sheraton" },
];
---

<section id="ubicacion" class="w-full relative bg-gray-100 overflow-hidden min-h-screen flex items-center">
  <div class="flex flex-col md:flex-row md:max-w-none w-full">
      <!-- Información de la ubicación - Lado izquierdo -->
      <div class="w-full md:w-1/2 py-16 md:py-24 px-4 md:px-8">
        <div class="md:max-w-xl mx-auto md:mx-0">
          <h2 class="text-4xl md:text-5xl font-bold mb-6 text-center">
            {title}
          </h2>
          
          <p class="text-lg mb-8">
            San Francisco es una de las zonas más codiciadas de Ciudad de Panamá, y PH Astre se sitúa justo en su núcleo. Vive a minutos de destino como:
          </p>
          
          <!-- Lista de lugares cercanos -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-10">
            {locations.map(location => (
              <div class="flex items-center">
                <div class="w-8 h-8 rounded-full border border-black flex items-center justify-center mr-3">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 13L9 17L19 7" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <span class="text-lg">{location.name}</span>
              </div>
            ))}
          </div>
          
          <!-- Botón de ubicación -->
          <div class="flex justify-center md:justify-start">
            <a
              href="https://maps.app.goo.gl/j7CG3XsMig97BgDF6"
              target="_blank"
              rel="noopener noreferrer"
              class="group inline-flex items-center justify-between px-6 py-3 border border-black rounded-md bg-white text-black hover:bg-black hover:text-white transition-colors duration-300">
              <span class="text-lg mr-4">Ubicación del proyecto</span>
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                class="transition-transform duration-300 group-hover:translate-x-1"
              >
                <path
                  d="M5 12H19M19 12L12 5M19 12L12 19"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"></path>
              </svg>
            </a>
          </div>
        </div>
      </div>
      
      <!-- Mapa - Lado derecho -->
      <div class="w-full md:w-1/2 relative">
        <div class="h-[300px] md:h-full md:absolute md:inset-0 md:right-0">
          <button 
            id="open-map-modal"
            class="w-full h-full border-0 p-0 m-0 bg-transparent cursor-pointer"
            aria-label="Ver mapa ampliado"
          >
            <img 
              src={mapImageUrl} 
              alt="Mapa de ubicación de Astre" 
              class="w-full h-full object-cover md:object-right-top" 
              id="map-image"
              style="margin-right: -1px;"
            />
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<MapModal imageUrl={mapImageUrl} imageAlt="Mapa detallado de ubicación de Astre" />

<script is:inline>
  // Esperar a que el DOM esté completamente cargado
  window.addEventListener('load', () => {
    // Obtener referencias a los elementos
    const openModalBtn = document.getElementById('open-map-modal');
    const mapImage = document.getElementById('map-image');
    const mapModal = document.getElementById('map-modal');
    const modalImage = document.getElementById('modal-map-image');
    
    // Si todos los elementos necesarios están disponibles
    if (openModalBtn && mapImage && mapModal && modalImage) {
      // Configurar el evento de clic directamente
      openModalBtn.addEventListener('click', () => {
        console.log('Map button clicked'); // Debugging
        
        // Obtener la URL de la imagen
        const imageUrl = mapImage.getAttribute('src');
        if (imageUrl) {
          // Actualizar la imagen del modal
          modalImage.src = imageUrl;
        }
        
        // Mostrar el modal
        mapModal.classList.remove('hidden');
        mapModal.classList.add('flex');
        document.body.style.overflow = 'hidden';
      });
      
      console.log('Map modal click handler set up'); // Debugging
    } else {
      console.error('Algunos elementos del modal de mapa no fueron encontrados');
    }
  });
</script>
