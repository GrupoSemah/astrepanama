---
import Carousel from "../ui/Carousel.astro";
import { getImageUrl } from '@/services/cloudStorage';

interface Props {
  title?: string;
}

const { 
  title = "Vive en lo alto del confort"
} = Astro.props;

const imageFolder = "DISENO";

const imageNames = [
  "Disen%CC%83o_Imagenes-01.webp",
  "Disen%CC%83o_Imagenes-02.webp",
  "Disen%CC%83o_Imagenes-03.webp",
  "Disen%CC%83o_Imagenes-04.webp",
  "Disen%CC%83o_Imagenes-05.webp",
  "Disen%CC%83o_Imagenes-06.webp"
];

const carouselImages = imageNames.map(name => getImageUrl(name, imageFolder));
---

<section id="diseno" class="w-full bg-white overflow-hidden pt-20 md:pt-20">
  <div class="md:hidden">
    <div class="mb-8">
      <Carousel images={carouselImages} showDragIndicator={true} />
    </div>
    
    <div class="px-6 max-w-[394px] mx-auto">
      <h2 class="text-4xl font-bold mb-5 text-center" style="font-family: var(--font-heading);">
        Vive en lo alto del confort
      </h2>
      
      <p class="text-base text-gray-700 mb-4 text-center" style="font-family: var(--font-body);">
        Ubicado en el prestigioso sector de San Francisco, PH Astre redefine el concepto de vida urbana en Ciudad de Panamá.
      </p>
      
      <p class="text-base text-gray-700 mb-8 text-center" style="font-family: var(--font-body);">
        Este exclusivo proyecto residencial combina elegancia, funcionalidad y una conexión directa con los puntos más dinámicos de la ciudad.
      </p>
      
      <div class="flex justify-center">
        <a 
          href="#contacto" 
          class="group inline-flex items-center px-8 py-4 border-2 border-black text-black font-medium rounded-lg transition-colors hover:bg-black hover:text-white"
        >
          <span>Agendar una visita</span>
          <svg 
            class="ml-2 w-5 h-5 transition-transform duration-300 group-hover:rotate-90" 
            viewBox="0 0 24 24" 
            fill="none" 
            xmlns="http://www.w3.org/2000/svg"
          >
            <path 
              d="M7 17L17 7M17 7H7M17 7V17" 
              stroke="currentColor" 
              stroke-width="2" 
              stroke-linecap="round" 
              stroke-linejoin="round"
            />
        </a>
      </div>
    </div>
  </div>
  
  <div class="hidden md:block container mx-auto px-8 pb-24">
    <div class="max-w-4xl mx-auto text-center mb-12">
      <h2 class="text-6xl font-bold mb-6" style="font-family: var(--font-heading);">
        Vive en lo alto del confort
      </h2>
      
      <p class="text-md text-gray-700 mb-4" style="font-family: var(--font-body);">
        Ubicado en el prestigioso sector de San Francisco, PH Astre redefine el concepto de vida urbana en Ciudad de Panamá.
      </p>
      
      <p class="text-md text-gray-700 mb-8" style="font-family: var(--font-body);">
        Este exclusivo proyecto residencial combina elegancia, funcionalidad y una conexión directa con los puntos más dinámicos de la ciudad.
      </p>
      
      <div class="flex justify-center mb-12">
        <a 
          href="#contacto" 
          class="group inline-flex items-center px-4 py-2 border-2 border-black text-black font-medium rounded-lg transition-colors hover:bg-black hover:text-white"
        >
          <span>Agenda una visita</span>
          <svg 
            class="ml-2 w-5 h-5 transition-transform duration-300 group-hover:rotate-90" 
            viewBox="0 0 24 24" 
            fill="none" 
            xmlns="http://www.w3.org/2000/svg"
          >
            <path 
              d="M7 17L17 7M17 7H7M17 7V17" 
              stroke="currentColor" 
              stroke-width="2" 
              stroke-linecap="round" 
              stroke-linejoin="round"
            />
        </a>
      </div>
    </div>
    
    <div class="max-w-3xl mx-auto relative">
      
      <Carousel 
        id="design-carousel"
        images={carouselImages} 
        showDragIndicator={true} 
        class="max-w-5xl mx-auto rounded-xl overflow-hidden"
        useNavDots={true}
      />
      
      <div class="flex justify-center mt-6 gap-3">
        {carouselImages.map((image: string, index: number) => (
          <button 
            class={`carousel-indicator w-3 h-3 rounded-full transition-colors ${index === 0 ? 'bg-primary' : 'bg-gray-300 hover:bg-gray-500'}`}
            data-index={index}
            aria-label={`Ir a imagen ${index + 1}`}
          ></button>
        ))}
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Obtener referencias de elementos
      const carouselContainer = document.getElementById('design-carousel');
      const indicators = document.querySelectorAll('#diseno .carousel-indicator');
      
      // Verificar que existan los elementos
      if (!carouselContainer || indicators.length === 0) {
        console.warn('No se encontraron elementos necesarios para la navegación del carousel');
        return;
      }
      
      // Método para manejar el cambio de slide
      const goToSlide = (index: number): void => {
        // Obtener instance del carousel (añadida previamente al elemento)
        const carouselInstance = (carouselContainer as HTMLElement).querySelector('.carousel-track') as HTMLElement;
        
        // Calculamos el ancho para hacer la transformación manualmente si es necesario
        if (carouselInstance) {
          const slideWidth = carouselContainer.clientWidth;
          carouselInstance.classList.add('transition-transform');
          carouselInstance.style.transform = `translateX(-${index * slideWidth}px)`;
          
          // Actualizar estado visual de los indicadores
          indicators.forEach((ind: Element, i: number) => {
            if (i === index) {
              ind.classList.add('bg-primary');
              ind.classList.remove('bg-gray-300');
            } else {
              ind.classList.remove('bg-primary');
              ind.classList.add('bg-gray-300');
            }
          });
        }
      };
      
      // Asociar evento click a cada indicador
      indicators.forEach((indicator: Element, index: number) => {
        indicator.addEventListener('click', () => {
          goToSlide(index);
        });
      });
    });
  </script>
</section>
